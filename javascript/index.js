document.getElementById('date').innerHTML = new Date().toDateString();


function step_ems_to_conc(R,E,alpha,a,tau,PI_conc,emis2conc,dt) {
  // dt = 1;

  for (var i = R.length - 1; i >= 0; i--) {
    R[i] = E * emis2conc * a[i] * alpha * (tau[i]/dt) * ( 1. - Math.exp( -dt/(alpha*tau[i]) ) ) + R[i] * Math.exp( -dt/(alpha * tau[i]) );
  };

  const sumR = arr => arr.reduce((a,b) => a + b, 0)

  var C = PI_conc + sumR(R);

  var G_A = sumR(R) / emis2conc;

  return [C,R,G_A];
};

function step_conc_to_forcing(C,PI_conc,f) {

  var RF = f[0] * Math.log(C/PI_conc)  +  f[1] * (C - PI_conc)  +  f[2] * (Math.sqrt(C) - Math.sqrt(PI_conc));

  return RF;
};

function step_forcing_to_temp(S,F,q,d,dt) {
  // dt = 1;

  for (var i = S.length - 1; i >= 0; i--) {
    S[i] = q[i] * F * (1.0 - Math.exp(-dt/d[i]))  +  S[i] * Math.exp(-dt/d[i]);
  };
  
  const sumS = arr => arr.reduce((a,b) => a + b, 0)

  var T = sumS(S);

  return [S,T];
};

function tcr_ecs_to_q(TCR,ECS,d,F_2x) {
  // F_2x=3.79866
  var k = [0,0];
  var q = [0,0];

  k[0] = 1.0 - ((d[0]/70.0)*(1.0 - Math.exp(-70.0/d[0])));
  k[1] = 1.0 - ((d[1]/70.0)*(1.0 - Math.exp(-70.0/d[1])));

  q[0] = (ECS*k[1] - TCR)/(F_2x * (k[1] - k[0]));
  q[1] = (TCR - ECS*k[0])/(F_2x * (k[1] - k[0]));

  return q;
};

function calculate_alpha(G,G_A,T,r,g0,g1) {
  iirf100_max = 97.0;

  var iirf100_val_1 = Math.abs(r[0] + r[1]*(G-G_A) + r[2]*T);

  if (iirf100_val_1 < iirf100_max) {
    var iirf100_val = iirf100_val_1;
  } else {
    var iirf100_val = iirf100_max;
  };

  var alpha = g0 * Math.sinh(iirf100_val / g1);

  return alpha;
};

function fair_scm(emissions, other_rf, d, TCR, ECS, r, tau, a, dt, PI_conc, f, emis2conc, F_2x) {

  var G = 0.0;
  var G_A = 0.0;
  var q = tcr_ecs_to_q(TCR,ECS,d,F_2x);

  const sum_g_calc = arr => arr.reduce((a,b) => a + b, 0)

  var for_g1_sum = [0,0,0,0];
  for (var i = for_g1_sum.length - 1; i >= 0; i--) {
    for_g1_sum[i] = a[i] * tau[i] * (1.0 - (1.0 + 100.0/tau[i]) * Math.exp(-100.0/tau[i]));
  };
  var g1 = sum_g_calc(for_g1_sum);

  var for_g0_sum = [0,0,0,0];
  for (var i = for_g0_sum.length - 1; i >= 0; i--) {
    for_g0_sum[i] = a[i] * tau[i] * (1.0 - Math.exp(-100.0/tau[i]));
  };
  var g0 = 1.0 / Math.sinh(sum_g_calc(for_g0_sum) / g1);

  var R = [0.0,0.0,0.0,0.0];
  var C = Array(emissions.length).fill(278.0);
  var RFs = Array(emissions.length).fill(0.0);
  var S = [0.0,0.0];
  var Ts = Array(emissions.length).fill(0.0);

  var alpha = calculate_alpha(G,G_A,Ts[0],r,g0,g1);

  var return_C = step_ems_to_conc(R,emissions[0],alpha,a,tau,PI_conc,emis2conc,dt);
  C[0] = return_C[0];
  var R = return_C[1];
  var G_A = return_C[2];
  G += emissions[0];

  RFs[0] = step_conc_to_forcing(C[0],PI_conc,f) + other_rf[0];

  var return_T = step_forcing_to_temp(S,RFs[0],q,d,dt);
  var S = return_T[0];
  Ts[0] = return_T[1];

  for (var i = 1; i <= emissions.length - 1; i++) {

    alpha = calculate_alpha(G,G_A,Ts[i],r,g0,g1);

    var return_C = step_ems_to_conc(R,emissions[i],alpha,a,tau,PI_conc,emis2conc,dt);

    C[i] = return_C[0];
    var R = return_C[1];
    var G_A = return_C[2];
    G += emissions[i];

    // console.log(i + 1765);
    // console.log(alpha);
    // console.log(return_C);

    RFs[i] = step_conc_to_forcing(C[i],PI_conc,f) + other_rf[i];

    var return_T = step_forcing_to_temp(S,RFs[i],q,d,dt);
    var S = return_T[0];
    Ts[i] = return_T[1];
  };

  return [C,RFs,Ts];
};



function def_emissions(E_hist, net_zero_date) {

  for (var i = 2021; i <= net_zero_date; i++) {
    
    E_hist[i-1765] = E_hist[2020-1765] * (net_zero_date - i)/(net_zero_date-2020);

  };

  return E_hist;
};

E_pre2020 = [1.188,1.679,0.868,0.723,0.679,0.671,0.678,0.691,0.706,0.724,0.747,0.772,0.792,0.799,0.793,0.78,0.767,0.761,0.767,0.786,0.813,0.84,0.858,0.864,0.859,0.851,0.845,0.838,0.829,0.819,0.808,0.798,0.787,0.775,0.762,0.749,0.736,0.723,0.709,0.695,0.684,0.675,0.659,0.636,0.611,0.59,0.57,0.549,0.53,0.522,0.529,0.546,0.554,0.54,0.51,0.474,0.443,0.419,0.4,0.387,0.378,0.369,0.36,0.353,0.346,0.269,0.058,-0.114,-0.177,-0.224,-0.26,-0.291,-0.216,-0.056,0.036,0.12,0.256,0.358,0.457,0.608,0.672,0.664,0.736,0.771,0.748,0.757,0.718,0.716,0.772,0.793,0.808,0.824,0.893,0.924,0.892,0.89,0.84,0.83,0.878,0.84,0.781,0.763,0.805,0.865,0.884,0.946,1.021,1.102,1.242,1.348,1.452,1.61,1.731,1.849,2.017,2.147,2.169,2.162,2.202,2.161,2.038,1.914,1.771,1.668,1.571,1.475,1.43,1.344,1.245,1.193,1.153,1.173,1.319,1.506,1.612,1.707,1.799,1.847,1.944,2.101,2.216,2.219,2.193,2.203,2.217,2.178,2.126,2.12,2.074,2.015,2.048,2.1,2.061,2.003,2.038,2.146,2.178,2.146,2.248,2.38,2.374,2.392,2.51,2.551,2.531,2.595,2.622,2.54,2.482,2.469,2.361,2.128,1.906,1.725,1.545,1.312,1.064,0.907,0.871,0.918,0.996,1.094,1.207,1.331,1.518,1.777,1.96,2.088,2.309,2.548,2.698,2.832,2.902,3.022,3.334,3.507,3.438,3.239,3.086,3.489,4.175,4.29,4.545,5.15,4.977,4.594,5.392,6.081,5.336,4.825,5.378,6.218,6.54,6.912,7.395,6.612,5.923,6.501,6.992,6.98,7.061,7.778,8.441,7.939,7.15,6.585,5.856,5.79,6.668,7.497,7.481,7.671,8.695,8.601,7.636,7.684,8.56,9.054,8.817,8.751,8.8,8.699,8.863,9.293,9.587,9.686,9.871,10.112,10.362,10.617,10.86,11.086,11.3,11.34,11.38,11.42];

var years = [...Array(2101-1765).keys()];
for (var i = years.length - 1; i >= 0; i--) {
  years[i] += 1765;
};

E_hist = Array(years.length).fill(0.0);

for (var i = 0; i <= 2020-1765; i++) {
  E_hist[i] = E_pre2020[i];
};

E = def_emissions(E_hist, 2055);





const RF_rest = [0,0,0,0,0,0,0,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.005,0.005,0.005,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.006,0.007,0.007,0.007,0.007,0.007,0.007,0.007,0.008,0.008,0.008,0.008,0.008,0.008,0.008,0.008,0.009,0.009,0.009,0.009,0.009,0.009,0.01,0.01,0.01,0.011,0.011,0.012,0.012,0.013,0.013,0.013,0.014,0.014,0.015,0.015,0.015,0.016,0.016,0.016,0.016,0.015,0.015,0.015,0.015,0.014,0.014,0.014,0.014,0.015,0.015,0.015,0.015,0.015,0.015,0.015,0.016,0.016,0.016,0.016,0.016,0.016,0.016,0.016,0.016,0.016,0.017,0.018,0.018,0.017,0.017,0.018,0.018,0.017,0.018,0.019,0.019,0.019,0.02,0.021,0.022,0.022,0.022,0.023,0.024,0.025,0.026,0.027,0.027,0.028,0.028,0.028,0.029,0.03,0.032,0.033,0.034,0.036,0.038,0.039,0.039,0.04,0.04,0.04,0.042,0.043,0.044,0.046,0.046,0.045,0.047,0.049,0.051,0.054,0.056,0.058,0.06,0.062,0.064,0.065,0.066,0.065,0.066,0.067,0.069,0.069,0.069,0.07,0.072,0.073,0.073,0.075,0.079,0.081,0.083,0.085,0.087,0.085,0.088,0.09,0.09,0.09,0.089,0.089,0.089,0.089,0.088,0.088,0.088,0.088,0.087,0.087,0.087,0.086,0.086,0.086,0.085,0.085,0.085,0.084,0.084,0.083,0.083,0.082,0.082,0.081,0.081,0.08,0.08,0.079,0.079,0.079,0.079,0.078,0.078,0.078,0.078,0.077,0.077,0.077,0.077,0.077,0.076,0.076,0.076,0.076,0.075,0.075,0.075,0.075,0.075,0.075,0.074,0.074,0.074,0.074,0.074,0.074,0.073,0.073,0.073,0.073,0.073,0.073,0.073,0.073,0.073,0.073,0.072,0.072,0.072,0.072,0.072,0.072,0.072,0.072,0.072,0.071,0.071,0.071,0.071,0.071,0.071,0.071,0.071,0.071,0.071,0.071,0.071];
const RF_gauss = [0,0.006,0.013,0.013,0.014,0.015,0.015,0.016,0.017,0.017,0.018,0.019,0.019,0.02,0.02,0.021,0.022,0.022,0.023,0.023,0.024,0.025,0.025,0.026,0.026,0.027,0.028,0.029,0.03,0.03,0.031,0.032,0.033,0.034,0.035,0.037,0.038,0.039,0.04,0.041,0.042,0.044,0.045,0.046,0.048,0.049,0.05,0.052,0.053,0.054,0.056,0.057,0.059,0.06,0.061,0.063,0.064,0.066,0.067,0.069,0.07,0.071,0.073,0.074,0.076,0.077,0.079,0.08,0.082,0.083,0.085,0.086,0.088,0.09,0.091,0.093,0.095,0.096,0.098,0.1,0.102,0.104,0.105,0.107,0.109,0.11,0.113,0.113,0.113,0.115,0.117,0.118,0.12,0.121,0.122,0.124,0.125,0.128,0.132,0.134,0.136,0.138,0.14,0.142,0.144,0.146,0.147,0.145,0.144,0.145,0.147,0.148,0.149,0.151,0.152,0.154,0.155,0.158,0.161,0.163,0.165,0.167,0.169,0.171,0.174,0.176,0.179,0.181,0.183,0.185,0.186,0.189,0.191,0.194,0.196,0.199,0.2,0.202,0.206,0.209,0.212,0.215,0.219,0.223,0.228,0.233,0.239,0.246,0.253,0.259,0.265,0.271,0.276,0.282,0.287,0.292,0.296,0.3,0.306,0.311,0.316,0.322,0.326,0.331,0.336,0.341,0.345,0.35,0.355,0.36,0.365,0.37,0.375,0.38,0.385,0.39,0.395,0.399,0.405,0.411,0.417,0.421,0.425,0.432,0.439,0.447,0.446,0.445,0.453,0.462,0.47,0.478,0.487,0.498,0.513,0.53,0.54,0.55,0.565,0.58,0.596,0.613,0.631,0.65,0.671,0.693,0.72,0.749,0.775,0.8,0.826,0.849,0.871,0.897,0.923,0.949,0.973,0.989,1.003,1.022,1.04,1.058,1.075,1.095,1.116,1.134,1.142,1.148,1.155,1.159,1.164,1.17,1.177,1.188,1.198,1.206,1.21,1.216,1.224,1.23,1.235,1.24,1.246,1.253,1.261,1.27,1.28,1.291,1.304,1.316,1.33,1.344,1.358,1.373,1.389,1.406,1.422,1.437,1.451,1.466,1.48,1.494,1.509,1.523,1.538,1.552,1.567,1.58,1.593,1.606,1.62,1.633,1.647,1.66,1.674,1.687,1.7,1.713,1.727,1.74,1.753,1.766,1.78,1.793,1.806,1.82,1.833,1.847,1.861,1.874,1.887,1.9,1.913,1.925,1.937,1.949,1.961,1.973,1.984,1.995,2.006,2.016,2.025,2.034,2.043,2.052,2.06,2.068,2.077,2.085,2.093,2.101,2.109,2.116,2.124,2.131,2.139,2.146,2.154,2.161,2.169,2.176,2.184,2.191,2.199,2.206,2.213,2.221,2.229,2.236,2.243,2.25,2.256,2.262,2.268,2.274];
const RF_aero = [0,-0.001,-0.002,-0.003,-0.005,-0.006,-0.008,-0.01,-0.011,-0.012,-0.014,-0.015,-0.016,-0.017,-0.018,-0.019,-0.021,-0.022,-0.023,-0.024,-0.025,-0.026,-0.027,-0.028,-0.029,-0.029,-0.031,-0.032,-0.032,-0.033,-0.034,-0.034,-0.035,-0.036,-0.037,-0.038,-0.039,-0.04,-0.041,-0.041,-0.042,-0.042,-0.043,-0.044,-0.044,-0.044,-0.045,-0.046,-0.046,-0.046,-0.047,-0.048,-0.049,-0.05,-0.05,-0.05,-0.05,-0.051,-0.052,-0.052,-0.053,-0.053,-0.054,-0.054,-0.054,-0.057,-0.059,-0.058,-0.059,-0.059,-0.06,-0.062,-0.063,-0.063,-0.064,-0.065,-0.066,-0.067,-0.068,-0.069,-0.072,-0.073,-0.074,-0.075,-0.077,-0.079,-0.08,-0.084,-0.089,-0.092,-0.095,-0.097,-0.099,-0.099,-0.101,-0.109,-0.12,-0.119,-0.116,-0.118,-0.122,-0.129,-0.137,-0.14,-0.139,-0.14,-0.148,-0.165,-0.18,-0.183,-0.183,-0.183,-0.18,-0.178,-0.182,-0.193,-0.2,-0.2,-0.202,-0.204,-0.203,-0.202,-0.205,-0.214,-0.219,-0.222,-0.229,-0.234,-0.237,-0.241,-0.246,-0.25,-0.252,-0.255,-0.26,-0.265,-0.27,-0.276,-0.282,-0.289,-0.295,-0.302,-0.31,-0.313,-0.313,-0.318,-0.32,-0.321,-0.324,-0.323,-0.32,-0.322,-0.326,-0.328,-0.325,-0.326,-0.325,-0.323,-0.333,-0.341,-0.342,-0.345,-0.349,-0.353,-0.357,-0.359,-0.355,-0.35,-0.35,-0.354,-0.357,-0.361,-0.364,-0.361,-0.359,-0.364,-0.371,-0.376,-0.38,-0.386,-0.39,-0.396,-0.408,-0.42,-0.428,-0.438,-0.452,-0.466,-0.478,-0.49,-0.503,-0.516,-0.53,-0.541,-0.55,-0.559,-0.573,-0.588,-0.601,-0.613,-0.624,-0.635,-0.648,-0.66,-0.669,-0.672,-0.677,-0.69,-0.705,-0.72,-0.735,-0.751,-0.766,-0.778,-0.787,-0.802,-0.819,-0.832,-0.846,-0.857,-0.866,-0.874,-0.884,-0.893,-0.899,-0.904,-0.906,-0.909,-0.909,-0.906,-0.9,-0.895,-0.901,-0.914,-0.924,-0.936,-0.944,-0.946,-0.949,-0.952,-0.952,-0.944,-0.933,-0.922,-0.911,-0.903,-0.9,-0.9,-0.901,-0.901,-0.901,-0.901,-0.902,-0.902,-0.902,-0.901,-0.899,-0.896,-0.893,-0.89,-0.887,-0.883,-0.88,-0.877,-0.874,-0.869,-0.862,-0.853,-0.844,-0.835,-0.827,-0.818,-0.809,-0.799,-0.79,-0.782,-0.774,-0.766,-0.759,-0.751,-0.743,-0.736,-0.728,-0.72,-0.712,-0.706,-0.701,-0.697,-0.693,-0.689,-0.686,-0.682,-0.678,-0.674,-0.67,-0.667,-0.664,-0.661,-0.658,-0.655,-0.652,-0.649,-0.646,-0.643,-0.641,-0.638,-0.635,-0.633,-0.631,-0.629,-0.627,-0.625,-0.622,-0.62,-0.618,-0.615,-0.611,-0.605,-0.6,-0.594,-0.589,-0.584,-0.578,-0.573,-0.568,-0.563,-0.56,-0.557,-0.555,-0.552,-0.55,-0.547,-0.545,-0.542,-0.54,-0.538];
const RF_future = [0.618,0.635,0.657,0.678,0.695,0.705,0.712,0.722,0.728,0.731,0.737,0.728,0.718,0.714,0.714,0.712,0.697,0.688,0.686,0.679,0.666,0.658,0.648,0.642,0.635,0.626,0.616,0.608,0.6,0.593,0.59,0.581,0.576,0.565,0.556,0.546,0.541,0.536,0.53,0.525,0.519,0.511,0.507,0.503,0.5,0.496,0.492,0.487,0.479,0.471,0.467,0.457,0.451,0.447,0.443,0.443,0.442,0.437,0.433,0.434,0.432,0.43,0.429,0.424,0.426,0.429,0.423,0.419,0.414,0.412,0.41,0.405,0.403,0.401,0.399,0.395,0.394,0.39,0.387,0.385,0.382];

const top_aero_sf = 1.1; 
const top_gauss_sf = 0.78; 

const middle_aero_sf = 1.05;
const middle_gauss_sf = 1.0;

const bottom_aero_sf = 0.65; 
const bottom_gauss_sf = 1.39;

var RF_top_original = Array(years.length).fill(0.0);
var RF_bottom_original = Array(years.length).fill(0.0);
var RF_middle_original = Array(years.length).fill(0.0);
for (var i = 0; i <= years.length-1; i++) {
  RF_top_original[i] = RF_gauss[i]*top_gauss_sf + RF_aero[i]*top_aero_sf + RF_rest[i];
  RF_bottom_original[i] = RF_gauss[i]*bottom_gauss_sf + RF_aero[i]*bottom_aero_sf + RF_rest[i];
  RF_middle_original[i] = RF_gauss[i]*middle_gauss_sf + RF_aero[i]*middle_aero_sf + RF_rest[i];

  if (i>2020-1765) {
    RF_top_original[i] = RF_top_original[2020-1765] + RF_future[i-2020+1765] - RF_future[0];
    RF_bottom_original[i] = RF_bottom_original[2020-1765] + RF_future[i-2020+1765] - RF_future[0];
    RF_middle_original[i] = RF_middle_original[2020-1765] + RF_future[i-2020+1765] - RF_future[0];
  };
};





function def_otherRF(RF_central, rf_2100_val, RF_middle_original) {

  var RF_2030_fixed_central = Array(2101-1765).fill(0.0);
  var RF_2030_fixed_original = Array(2101-1765).fill(0.0);
  for (var i = 2031-1765; i <= RF_2030_fixed_central.length - 1; i++) {
    RF_2030_fixed_central[i] = RF_central[2030-1765];
    RF_2030_fixed_original[i] = RF_middle_original[2030-1765];
  };

  for (var i = 2031; i <= 2100; i++) {

    // RF_central[i-1765] = RF_central[i-1765]*(2100-i)/(2100-2030) + (rf_2100_val-0.315)*(i-2030)/(2100-2030) + RF_central[i-1765]*(i-2030)/(2100-2030);

    // RF_central[i-1765] = RF_2030_fixed[i-1765]*(rf_2100_val - RF_middle_original[2100-1765])/(RF_2030_fixed[2100-1765] - RF_middle_original[2100-1765])  +  RF_central[i-1765]*(RF_2030_fixed[2100-1765] - rf_2100_val)/(RF_2030_fixed[2100-1765] - RF_middle_original[2100-1765]);

    RF_central[i-1765] = RF_central[i-1765]*(RF_2030_fixed_original[2100-1765] - rf_2100_val)/(RF_2030_fixed_original[2100-1765] - RF_middle_original[2100-1765]) + RF_2030_fixed_central[i-1765]*(rf_2100_val - RF_middle_original[2100-1765])/(RF_2030_fixed_original[2100-1765] - RF_middle_original[2100-1765]);

    // RF_central[i-1765]*(2100-i)/(2100-2030) + (rf_2100_val-0.315)*(i-2030)/(2100-2030) + RF_central[i-1765]*(i-2030)/(2100-2030);

  };

  return RF_central;
};

RF_top = def_otherRF(RF_top_original, 0.315, RF_middle_original);
RF_bottom = def_otherRF(RF_bottom_original, 0.315, RF_middle_original);
RF_middle = def_otherRF(RF_middle_original, 0.315, RF_middle_original);





// for top line to work...
// var r = [22.0,0.045,7.0];
// var TCR = 2.55;
// var ECS = 5.0;

// for top line to work...
var r_top = [20.0,0.05,6.2];
var TCR_top = 2.5;
var ECS_top = 4.5;

// for central line to work...
// var r = [31.1,0.019,4.165];
// var TCR = 1.75;
// var ECS = 2.6;

// for bottom line to work...
var r_bottom = [39.0,0.0,0.0];
var TCR_bottom = 1.0;
var ECS_bottom = 1.5;

var tau = [1000000,394.4,36.54,4.304];
var a = [0.2173,0.2240,0.2824,0.2763];
var f = [3.74/Math.log(2.0),0.0,0.0];
var d = [409.5,8.4];
var dt = 1.0;
var PI_conc = 278.0;
var emis2conc = 0.468952344;
var F_2x = 3.74;

var fair_out_top = fair_scm(E, RF_top, d, TCR_top, ECS_top, r_top, tau, a, dt, PI_conc, f, emis2conc, F_2x);
var C_top = fair_out_top[0];
var RF_top_total = fair_out_top[1];
var T_top = fair_out_top[2];

//  rebaseline T
var years_for_slice = [...Array(1901-1850).keys()];
for (var i = 0; i <= years_for_slice.length - 1; i++) {
  years_for_slice[i] += 1850 - 1765;
};

var sum = 0;
for (var i = 0; i <= years_for_slice.length-1; i++) {
  sum += T_top[years_for_slice[i]];
};
var avg_top = sum / years_for_slice.length;

for (var i = 0; i<= T_top.length-1; i++) {
  T_top[i] -= avg_top;
};




var fair_out_bottom = fair_scm(E, RF_bottom, d, TCR_bottom, ECS_bottom, r_bottom, tau, a, dt, PI_conc, f, emis2conc, F_2x);
var C_bottom = fair_out_bottom[0];
var RF_bottom_total = fair_out_bottom[1];
var T_bottom = fair_out_bottom[2];

var sum_bottom = 0;
for (var i = 0; i <= years_for_slice.length-1; i++) {
  sum_bottom += T_bottom[years_for_slice[i]];
};
var avg_bottom = sum_bottom / years_for_slice.length;

for (var i = 0; i<= T_bottom.length-1; i++) {
  T_bottom[i] -= avg_bottom;
};






// put E in correct units for plotting
var E_plot = Array(E.length).fill(0);
var G_plot = Array(E.length).fill(0);
for (var i = 0; i <= E_plot.length-1; i++) {
  E_plot[i] = E[i] * 44 / 12;
  if (i>0) {
    G_plot[i] = G_plot[i-1] + E_plot[i];
  } else {
    G_plot[i] = E_plot[i];
  };
};

var to_remove = G_plot[1870-1765];
for (var i = G_plot.length - 1; i >= 0; i--) {
  G_plot[i] -= to_remove;
  G_plot[i] = G_plot[i]/1000.0;
};





var defTraces = [{
  // historical attributed warming 50th, 17th and 83rd percentile
  x: [1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018],
  y: [-0.02,-0.028,-0.027,-0.025,-0.024,-0.024,-0.024,-0.024,-0.023,-0.023,-0.023,-0.024,-0.024,-0.025,-0.025,-0.024,-0.024,-0.023,-0.022,-0.02,-0.019,-0.017,-0.015,-0.013,-0.011,-0.008,-0.005,-0.003,-0.002,0,0.002,0.003,0.004,0.005,0.007,0.009,0.011,0.014,0.018,0.022,0.026,0.029,0.032,0.035,0.038,0.04,0.043,0.045,0.048,0.051,0.054,0.056,0.057,0.059,0.063,0.066,0.069,0.073,0.076,0.08,0.084,0.086,0.09,0.093,0.097,0.102,0.107,0.112,0.117,0.122,0.127,0.133,0.137,0.141,0.144,0.147,0.15,0.153,0.156,0.16,0.163,0.166,0.17,0.175,0.179,0.184,0.188,0.192,0.196,0.2,0.204,0.208,0.212,0.215,0.219,0.221,0.223,0.225,0.226,0.227,0.229,0.231,0.233,0.235,0.238,0.24,0.242,0.245,0.248,0.251,0.255,0.259,0.262,0.265,0.269,0.273,0.278,0.283,0.289,0.295,0.302,0.31,0.32,0.331,0.343,0.357,0.371,0.387,0.403,0.42,0.438,0.457,0.473,0.49,0.506,0.522,0.538,0.555,0.571,0.588,0.603,0.618,0.633,0.647,0.659,0.671,0.683,0.695,0.708,0.722,0.735,0.749,0.763,0.777,0.792,0.808,0.825,0.841,0.859,0.876,0.892,0.909,0.927,0.946,0.966,0.987,1.009,1.033,1.056],
  visible: true,
  line: {color: 'rgb(158, 84, 0)'},
  name: '50th %-ile',
}, {
  x: [1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018],
  y: [-0.023,-0.022,-0.021,-0.02,-0.019,-0.019,-0.019,-0.019,-0.019,-0.018,-0.018,-0.019,-0.019,-0.02,-0.02,-0.019,-0.019,-0.018,-0.017,-0.016,-0.015,-0.013,-0.012,-0.01,-0.008,-0.007,-0.004,-0.003,-0.001,0,0.001,0.002,0.004,0.004,0.006,0.007,0.009,0.011,0.015,0.018,0.021,0.023,0.025,0.028,0.03,0.032,0.034,0.036,0.038,0.041,0.043,0.045,0.046,0.048,0.05,0.053,0.055,0.058,0.061,0.064,0.067,0.069,0.072,0.075,0.078,0.081,0.086,0.09,0.094,0.098,0.102,0.106,0.11,0.113,0.115,0.118,0.12,0.122,0.125,0.128,0.13,0.133,0.136,0.14,0.143,0.147,0.151,0.153,0.157,0.16,0.163,0.166,0.169,0.172,0.175,0.177,0.178,0.18,0.181,0.182,0.183,0.185,0.186,0.188,0.19,0.192,0.194,0.196,0.198,0.201,0.204,0.207,0.209,0.212,0.215,0.218,0.222,0.226,0.231,0.236,0.242,0.248,0.256,0.265,0.275,0.285,0.297,0.309,0.323,0.336,0.351,0.365,0.379,0.392,0.405,0.418,0.431,0.444,0.457,0.47,0.483,0.495,0.507,0.517,0.527,0.537,0.546,0.556,0.567,0.577,0.588,0.599,0.61,0.622,0.634,0.647,0.66,0.673,0.687,0.701,0.714,0.727,0.742,0.757,0.773,0.789,0.807,0.826,0.845],
  visible: true,
  line: {color: 'orange'},
  name: '17th %-ile'
}, {
  x: [1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018],
  y: [-0.035,-0.033,-0.032,-0.03,-0.029,-0.029,-0.029,-0.029,-0.028,-0.027,-0.028,-0.029,-0.029,-0.03,-0.029,-0.029,-0.028,-0.027,-0.026,-0.024,-0.022,-0.02,-0.018,-0.016,-0.013,-0.01,-0.007,-0.004,-0.002,0,0.002,0.004,0.005,0.007,0.008,0.011,0.013,0.017,0.022,0.027,0.031,0.035,0.038,0.042,0.046,0.048,0.051,0.054,0.057,0.061,0.065,0.067,0.069,0.071,0.075,0.079,0.083,0.087,0.091,0.096,0.1,0.104,0.108,0.112,0.116,0.122,0.129,0.135,0.141,0.147,0.153,0.159,0.165,0.169,0.173,0.177,0.18,0.183,0.187,0.192,0.196,0.2,0.205,0.209,0.215,0.221,0.226,0.23,0.235,0.24,0.245,0.25,0.254,0.259,0.262,0.265,0.268,0.27,0.271,0.273,0.275,0.277,0.28,0.282,0.285,0.288,0.29,0.294,0.297,0.302,0.306,0.31,0.314,0.318,0.322,0.327,0.333,0.34,0.346,0.354,0.363,0.372,0.384,0.397,0.412,0.428,0.445,0.464,0.484,0.505,0.526,0.548,0.568,0.587,0.607,0.627,0.646,0.665,0.685,0.705,0.724,0.742,0.76,0.776,0.79,0.805,0.819,0.835,0.85,0.866,0.882,0.898,0.915,0.933,0.951,0.97,0.99,1.01,1.031,1.051,1.071,1.091,1.112,1.135,1.159,1.184,1.211,1.239, 1.263],
  visible: true,
  line: {color: 'orange'},
  name: '83th %-ile',
  fill: 'tonexty',
  fillcolor: 'rgba(255,155,5,0.4)',
}, 
// historical observed warming (Mean of rebaselined NOAA, HadCRUT, HadCRUT-CW and GISTEMP records)
{
  x: [1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],
  y: [-0.41,0.1,-0.07,0.1,-0.1,0.2,0.18,-0.28,-0.14,-0.1,0.01,-0.68,-0.51,0.23,-0.59,0.16,0.24,0.02,-0.37,0.04,0.16,-0.23,-0.12,0.2,0.25,-0.23,-0.09,-0.04,0.37,0.15,0.08,0.08,0.37,-0.1,-0.01,-0.28,-0.11,-0.36,-0.19,0.15,-0.14,-0.19,-0.06,-0.57,-0.23,-0.19,0.06,0.08,0.19,0.08,-0.06,0.07,0.06,0,-0.36,-0.13,0.06,-0.13,-0.14,-0.36,-0.11,-0.31,-0.03,-0.16,0.28,0.11,0.08,-0.33,-0.14,0.08,0.07,0.17,-0.07,-0.01,0,-0.11,0.43,0.03,0.25,-0.19,-0.03,0.21,0.41,-0.03,0,-0.02,-0.03,0.15,0.29,0.18,0.19,0.34,0.53,0.17,0.6,0.34,0.4,0.15,0.34,0.38,-0.03,-0.07,0.43,0.34,0.03,0.4,0.08,0.13,0.58,0.35,0.25,0.33,0.34,0.26,0.22,0.18,0.15,0.15,0.04,0.15,0.37,0.22,-0.03,0.47,0.01,0.27,0.16,0.34,0.33,0.34,0.5,0.71,0.31,0.73,0.48,0.4,0.48,0.5,0.75,0.34,0.58,0.62,0.67,0.61,0.5,0.73,0.47,0.55,0.81,0.69,0.52,0.67,0.95,0.94,0.82,0.9,0.75,1.15,0.48,0.83,0.93,0.7,0.65,0.84,0.91,1.03,1.32,1.14],
  visible: true,
  line: {color: 'black'},
  name: 'Observations'
},

// grey plume to 2100
{
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.056,1.079,1.103,1.127,1.151,1.176,1.201,1.226,1.25,1.273,1.295,1.317,1.338,1.357,1.375,1.391,1.407,1.422,1.435,1.446,1.458,1.468,1.476,1.484,1.491,1.497,1.502,1.507,1.51,1.513,1.515,1.516,1.517,1.517,1.517,1.515,1.513,1.51,1.507,1.503,1.499,1.495,1.49,1.485,1.48,1.475,1.47,1.465,1.461,1.456,1.45,1.445,1.44,1.435,1.429,1.424,1.419,1.414,1.409,1.405,1.4,1.396,1.392,1.388,1.384,1.381,1.377,1.374,1.371,1.368,1.365,1.362,1.358,1.355,1.352,1.349,1.346,1.343,1.34,1.338,1.335,1.332,1.329],
  visible: false,
  line: {color: 'rgba(100,100,100,0.6)'},
  name: '50th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.845,0.859,0.874,0.889,0.904,0.92,0.935,0.95,0.964,0.978,0.991,1.003,1.015,1.026,1.036,1.046,1.054,1.062,1.069,1.076,1.082,1.087,1.092,1.095,1.099,1.102,1.104,1.106,1.107,1.108,1.109,1.109,1.109,1.108,1.107,1.106,1.104,1.102,1.099,1.096,1.094,1.091,1.087,1.084,1.081,1.078,1.074,1.071,1.068,1.065,1.062,1.058,1.055,1.052,1.048,1.045,1.042,1.039,1.036,1.033,1.03,1.028,1.025,1.023,1.021,1.019,1.017,1.015,1.013,1.011,1.009,1.007,1.005,1.003,1.002,1,0.998,0.996,0.995,0.993,0.992,0.99,0.988],
  visible: true,
  line: {color: 'rgba(100,100,100,0.6)'},
  name: '17th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.263,1.292,1.322,1.354,1.386,1.42,1.453,1.487,1.52,1.552,1.584,1.614,1.644,1.672,1.697,1.722,1.745,1.767,1.787,1.805,1.822,1.838,1.853,1.866,1.877,1.888,1.897,1.906,1.913,1.919,1.923,1.927,1.931,1.933,1.935,1.935,1.934,1.932,1.929,1.926,1.922,1.918,1.914,1.909,1.904,1.899,1.894,1.889,1.883,1.878,1.873,1.867,1.861,1.855,1.849,1.843,1.838,1.832,1.828,1.823,1.818,1.813,1.809,1.805,1.801,1.797,1.794,1.791,1.788,1.784,1.781,1.778,1.775,1.771,1.768,1.765,1.762,1.759,1.756,1.753,1.75,1.747,1.744],
  visible: true,
  line: {color: 'rgba(100,100,100,0.6)'},
  name: '83th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
  fill: 'tonexty', 
  fillcolor: 'rgba(100,100,100,0.6)'
},

// blue plume to 2100
{
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.056,1.079,1.103,1.127,1.151,1.176,1.201,1.224,1.247,1.269,1.29,1.31,1.329,1.345,1.36,1.373,1.385,1.396,1.404,1.411,1.417,1.421,1.423,1.425,1.424,1.423,1.422,1.419,1.416,1.412,1.408,1.403,1.398,1.393,1.388,1.383,1.377,1.371,1.366,1.36,1.354,1.348,1.343,1.337,1.332,1.326,1.321,1.316,1.311,1.306,1.301,1.296,1.291,1.286,1.281,1.276,1.271,1.267,1.263,1.259,1.255,1.251,1.247,1.244,1.241,1.238,1.235,1.232,1.229,1.227,1.224,1.221,1.218,1.216,1.213,1.21,1.208,1.205,1.203,1.2,1.198,1.195,1.193],
  visible: false,
  line: {color: 'rgba(84,130,255,0.8)'},
  name: '50th %-ile',
  opacity: 0.8,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.845,0.859,0.874,0.889,0.904,0.92,0.934,0.949,0.962,0.975,0.988,0.999,1.01,1.02,1.028,1.035,1.042,1.048,1.052,1.056,1.059,1.061,1.062,1.062,1.061,1.06,1.059,1.057,1.054,1.052,1.049,1.046,1.043,1.039,1.036,1.033,1.029,1.025,1.021,1.018,1.014,1.011,1.007,1.004,1,0.997,0.994,0.991,0.988,0.985,0.982,0.979,0.976,0.972,0.969,0.967,0.964,0.961,0.959,0.956,0.954,0.952,0.95,0.948,0.946,0.944,0.942,0.941,0.939,0.937,0.936,0.934,0.933,0.931,0.93,0.928,0.927,0.925,0.924,0.922,0.921,0.92,0.918],
  visible: true,
  line: {color: 'rgba(84,130,255,0.8)'},
  name: '17th %-ile',
  opacity: 0.8,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.263,1.292,1.322,1.354,1.386,1.419,1.452,1.485,1.517,1.547,1.577,1.605,1.631,1.655,1.677,1.696,1.714,1.731,1.744,1.755,1.765,1.772,1.778,1.781,1.783,1.783,1.782,1.78,1.778,1.774,1.77,1.765,1.761,1.756,1.75,1.744,1.738,1.732,1.725,1.719,1.712,1.706,1.7,1.693,1.687,1.681,1.675,1.67,1.664,1.659,1.653,1.647,1.642,1.636,1.63,1.624,1.619,1.614,1.609,1.604,1.6,1.596,1.592,1.588,1.585,1.582,1.579,1.576,1.573,1.57,1.567,1.564,1.562,1.559,1.556,1.553,1.55,1.548,1.545,1.543,1.54,1.537,1.535],
  visible: true,
  line: {color: 'rgba(84,130,255,0.8)'},
  name: '83th %-ile',
  opacity: 0.8,
  hoverinfo: 'none',
  fill: 'tonexty',
  fillcolor: 'rgba(84,130,255,0.2)'
},

// purple plume to 2100
{
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.056,1.079,1.103,1.127,1.151,1.176,1.201,1.226,1.25,1.273,1.295,1.317,1.338,1.358,1.376,1.394,1.411,1.426,1.441,1.455,1.468,1.481,1.492,1.503,1.513,1.522,1.531,1.538,1.545,1.552,1.558,1.563,1.567,1.571,1.574,1.576,1.578,1.579,1.58,1.58,1.579,1.579,1.578,1.576,1.575,1.573,1.572,1.57,1.568,1.566,1.564,1.562,1.56,1.558,1.556,1.554,1.552,1.55,1.548,1.546,1.544,1.542,1.54,1.538,1.537,1.535,1.533,1.531,1.53,1.528,1.527,1.525,1.524,1.522,1.521,1.52,1.518,1.517,1.516,1.515,1.513,1.512,1.511],
  visible: false,
  line: {color: 'rgba(128,0,104,0.6)'},
  name: '50th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.845,0.859,0.874,0.889,0.904,0.92,0.935,0.95,0.964,0.978,0.991,1.003,1.015,1.027,1.037,1.047,1.056,1.065,1.073,1.081,1.088,1.094,1.1,1.106,1.111,1.116,1.12,1.124,1.127,1.13,1.133,1.135,1.137,1.138,1.139,1.14,1.141,1.141,1.14,1.14,1.139,1.138,1.137,1.136,1.134,1.133,1.132,1.13,1.129,1.127,1.126,1.124,1.122,1.121,1.12,1.118,1.117,1.115,1.114,1.112,1.111,1.11,1.109,1.107,1.106,1.105,1.104,1.103,1.102,1.101,1.1,1.099,1.098,1.097,1.096,1.095,1.094,1.094,1.093,1.092,1.091,1.091,1.09],
  visible: true,
  line: {color: 'rgba(128,0,104,0.6)'},
  name: '17th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
}, {
  x: [2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [1.263,1.292,1.322,1.354,1.386,1.42,1.453,1.487,1.52,1.552,1.584,1.614,1.644,1.673,1.7,1.726,1.75,1.774,1.796,1.817,1.837,1.857,1.875,1.892,1.908,1.923,1.937,1.95,1.962,1.973,1.983,1.993,2.001,2.009,2.015,2.021,2.026,2.03,2.033,2.035,2.036,2.038,2.038,2.039,2.039,2.038,2.038,2.037,2.037,2.036,2.035,2.034,2.033,2.032,2.031,2.03,2.029,2.028,2.026,2.025,2.024,2.023,2.022,2.021,2.02,2.02,2.019,2.018,2.017,2.016,2.016,2.015,2.014,2.014,2.013,2.013,2.012,2.012,2.011,2.011,2.011,2.01,2.01],
  visible: true,
  line: {color: 'rgba(128,0,104,0.6)'},
  name: '83th %-ile',
  opacity: 0.6,
  hoverinfo: 'none',
  fill: 'tonexty',
  fillcolor: 'rgba(128,0,104,0.2)'
},


// Historical annual CO2 emissions 
{
  x: [1850,1851,1852,1853,1854,1855,1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],
  y: [2.713,2.75,2.787,2.823,2.86,2.897,2.933,2.97,2.97,3.007,2.933,2.933,2.897,2.897,2.933,2.97,2.933,2.97,3.007,3.007,3.3,3.447,3.557,3.667,3.703,3.85,3.887,3.923,3.997,4.07,4.143,4.217,4.327,4.4,4.473,4.51,4.51,4.583,4.73,4.73,4.987,5.097,5.17,5.243,5.317,5.463,5.537,5.647,5.793,5.94,6.16,6.343,6.49,6.71,6.747,6.967,7.15,7.443,7.333,7.517,7.553,7.59,7.7,7.92,7.517,7.443,7.627,7.81,7.737,7.26,7.92,7.553,7.81,8.287,8.287,8.397,8.397,8.727,8.763,9.057,8.91,8.69,8.433,8.69,9.057,9.35,9.79,10.12,9.9,10.083,10.597,10.817,10.817,11,10.927,10.083,10.34,10.817,11.073,10.78,11.843,12.54,12.723,12.98,13.2,13.933,14.557,14.997,15.327,15.473,15.437,15.217,15.473,15.767,16.207,16.5,16.94,17.233,17.857,18.663,19.543,19.983,20.46,21.23,21.12,20.937,21.817,22.293,22.367,23.32,23.247,22.697,22.55,22.66,23.467,24.127,24.86,25.52,26.363,26.95,26.913,27.207,27.06,27.023,27.427,27.83,28.27,30.397,28.453,28.307,29.333,29.48,30.433,32.01,33.11,33.77,34.98,34.98,36.19,37.437,38.463,39.673,40.517,40.993,41.177,41.617,40.883,41.58],
  visible: true,
  line: {color: 'black'},
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'CO<sub>2</sub>',
}, 

// grey future annual CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [41.433,41.58,41.727,41.873,40.677,39.481,38.284,37.088,35.891,34.695,33.499,32.302,31.106,29.91,28.713,27.517,26.32,25.124,23.928,22.731,21.535,20.338,19.142,17.946,16.749,15.553,14.357,13.16,11.964,10.767,9.571,8.375,7.178,5.982,4.786,3.589,2.393,1.196,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
}, 

// blue future annual CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [41.433,41.58,41.727,41.873,39.78,37.686,35.592,33.499,31.405,29.311,27.218,25.124,23.03,20.937,18.843,16.749,14.656,12.562,10.468,8.375,6.281,4.187,2.094,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  visible: true,
  line: {color: 'blue'},
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
},

// purple future annual CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [41.433,41.58,41.727,41.873,40.677,39.481,38.284,37.088,35.891,34.695,33.499,32.302,31.106,29.91,28.713,27.517,26.32,25.124,23.928,22.731,21.535,20.338,19.142,17.946,16.749,15.553,14.357,13.16,11.964,10.767,9.571,8.375,7.178,5.982,4.786,3.589,2.393,1.196,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  visible: false,
  line: {color: 'purple'},
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
},


// Historical cumulative CO2 emissions
{
  x: [1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017],
  y: [0.538,0.545,0.553,0.561,0.57,0.58,0.591,0.601,0.612,0.625,0.637,0.65,0.662,0.673,0.686,0.701,0.717,0.734,0.753,0.771,0.788,0.808,0.83,0.849,0.867,0.887,0.91,0.934,0.959,0.986,1.01,1.032,1.056,1.081,1.107,1.133,1.161,1.192,1.222,1.248,1.272,1.293,1.315,1.339,1.367,1.394,1.422,1.454,1.486,1.514,1.542,1.573,1.606,1.639,1.671,1.703,1.735,1.767,1.801,1.837,1.872,1.908,1.945,1.983,2.022,2.062,2.103,2.144],
  visible: true,
  line: {color: 'black'},
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'CO<sub>2</sub>',
}, 

// grey future cumulative CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [2.144,2.186,2.228,2.269,2.31,2.35,2.388,2.425,2.461,2.495,2.529,2.561,2.592,2.622,2.651,2.679,2.705,2.73,2.754,2.777,2.798,2.819,2.838,2.856,2.872,2.888,2.902,2.915,2.927,2.938,2.948,2.956,2.963,2.969,2.974,2.978,2.98,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981],
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
}, 

// blue future cumulative CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [2.144,2.186,2.228,2.269,2.309,2.347,2.382,2.416,2.447,2.477,2.504,2.529,2.552,2.573,2.592,2.609,2.623,2.636,2.646,2.655,2.661,2.665,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667,2.667],
  visible: true,
  line: {color: 'blue'},
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
},

// purple future cumulative CO2 emissions
{
  x: [2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [2.144,2.186,2.228,2.269,2.31,2.35,2.388,2.425,2.461,2.495,2.529,2.561,2.592,2.622,2.651,2.679,2.705,2.73,2.754,2.777,2.798,2.819,2.838,2.856,2.872,2.888,2.902,2.915,2.927,2.938,2.948,2.956,2.963,2.969,2.974,2.978,2.98,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981,2.981],
  visible: false,
  line: {color: 'purple'},
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'CO<sub>2</sub>',
  opacity: 0.2,
  hoverinfo: 'none',
},


// Historical non-CO2 forcing
{
  x: [1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011],
  y: [-0.027,-0.031,-0.038,-0.035,-0.032,-0.026,-0.02,-0.014,-0.006,0.007,0.028,0.052,0.067,0.077,0.087,0.098,0.105,0.112,0.128,0.147,0.157,0.162,0.165,0.168,0.177,0.188,0.2,0.209,0.221,0.238,0.253,0.26,0.263,0.27,0.277,0.289,0.302,0.305,0.301,0.302,0.299,0.296,0.3,0.306,0.313,0.321,0.336,0.355,0.375,0.393,0.414,0.429],
  visible: true,
  line: {color: 'black'},
  xaxis: 'x4',
  yaxis: 'y4',
  name: 'non-CO<sub>2</sub> RF',
}, 

// grey future non-CO2 radiative forcing
{
  x: [2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.429,0.439,0.451,0.464,0.477,0.49,0.504,0.519,0.534,0.551,0.568,0.59,0.611,0.628,0.638,0.645,0.655,0.661,0.664,0.67,0.661,0.651,0.647,0.647,0.645,0.63,0.621,0.619,0.612,0.599,0.591,0.581,0.575,0.568,0.559,0.549,0.541,0.533,0.526,0.523,0.514,0.509,0.498,0.489,0.479,0.474,0.469,0.463,0.458,0.452,0.444,0.44,0.436,0.433,0.429,0.425,0.42,0.412,0.404,0.4,0.39,0.384,0.38,0.376,0.376,0.375,0.37,0.366,0.367,0.365,0.363,0.362,0.357,0.359,0.362,0.356,0.352,0.347,0.345,0.343,0.338,0.336,0.334,0.332,0.328,0.327,0.323,0.32,0.318,0.315],
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x4',
  yaxis: 'y4',
  name: 'non-CO<sub>2</sub> RF',
  opacity: 0.2,
  hoverinfo: 'none',
}, 

// blue future non-CO2 radiative forcing
{
  x: [2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.429,0.439,0.451,0.464,0.477,0.49,0.504,0.519,0.534,0.551,0.568,0.59,0.611,0.628,0.638,0.645,0.655,0.661,0.664,0.67,0.661,0.651,0.647,0.647,0.645,0.63,0.621,0.619,0.612,0.599,0.591,0.581,0.575,0.568,0.559,0.549,0.541,0.533,0.526,0.523,0.514,0.509,0.498,0.489,0.479,0.474,0.469,0.463,0.458,0.452,0.444,0.44,0.436,0.433,0.429,0.425,0.42,0.412,0.404,0.4,0.39,0.384,0.38,0.376,0.376,0.375,0.37,0.366,0.367,0.365,0.363,0.362,0.357,0.359,0.362,0.356,0.352,0.347,0.345,0.343,0.338,0.336,0.334,0.332,0.328,0.327,0.323,0.32,0.318,0.315],
  visible: false,
  line: {color: 'blue'},
  xaxis: 'x4',
  yaxis: 'y4',
  name: 'non-CO<sub>2</sub> RF',
  opacity: 0.2,
  hoverinfo: 'none',
}, 

// purple future non-CO2 radiative forcing
{
  x: [2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100],
  y: [0.429,0.439,0.451,0.464,0.477,0.49,0.504,0.519,0.534,0.551,0.568,0.59,0.611,0.628,0.638,0.645,0.655,0.661,0.664,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67,0.67],
  visible: true,
  line: {color: 'purple'},
  xaxis: 'x4',
  yaxis: 'y4',
  name: 'non-CO<sub>2</sub> RF',
  opacity: 0.2,
  hoverinfo: 'none',
},

// to change each time slider is changed    25
{
  x: years.slice(2018-1765,2101-1765),
  y: E_plot.slice(2018-1765,2101-1765),
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'annual_ems_middle',
}, 
{
  x: years.slice(2016-1765,2101-1765),
  y: G_plot.slice(2016-1765,2101-1765),
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'cum_ems_middle',
}, 
{
  x: years.slice(2011-1765,2101-1765),
  y: RF_middle.slice(2011-1765,2101-1765),
  visible: true,
  line: {color: 'grey'},
  xaxis: 'x4',
  yaxis: 'y4',
  name: 'middle_rf',
},
{
  x: years.slice(2018-1765,2101-1765),
  y: T_top.slice(2018-1765,2101-1765),
  visible: false,
  line: {color: 'rgb(0, 0, 0)'},
  name: 'top',
}, 
{
  x: years.slice(2018-1765,2101-1765),
  y: T_bottom.slice(2018-1765,2101-1765),
  visible: false,
  line: {color: 'rgb(0, 0, 0)'},
  name: 'bottom',
}];


var layout = {
  margin: {t: 40, b: 60, l: 60, r: 40},
  showlegend: false,
  xaxis: {
    fixedrange: true,
    showgrid: false,
    domain: [0,1],
    range: [1960, 2100],
    anchor: 'y1',
    // title: 'Year',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  yaxis: {
    fixedrange: true,
    showline: true,
    domain: [0.45,1],
    range: [0, 3.25],
    anchor: 'x1',
    title: 'Temperature relative to 1850-1900 (℃)',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  xaxis2: {
    fixedrange: true,
    domain: [0,0.3],
    showgrid: false,
    range: [1960, 2100],
    anchor: 'y2',
    title: 'Year',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  yaxis2: {
    fixedrange: true,
    domain: [0,0.4],
    showline: true,
    showgrid: false,
    range: [0, 60],
    anchor: 'x2',
    title: 'Annual emissions (GtCO<sub>2</sub>/yr)',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  xaxis3: {
    fixedrange: true,
    domain: [0.35,0.64],
    showgrid: false,
    range: [1960, 2100],
    anchor: 'y3',
    title: 'Year',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  yaxis3: {
    fixedrange: true,
    domain: [0,0.4],
    showline: true,
    showgrid: false,
    range: [0, 4.0],
    anchor: 'x3',
    title: 'Cumulative emissions (TtCO<sub>2</sub>)',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  xaxis4: {
    fixedrange: true,
    domain: [0.7,1],
    showgrid: false,
    range: [1960, 2100],
    anchor: 'y4',
    title: 'Year',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
  yaxis4: {
    fixedrange: true,
    domain: [0,0.4],
    showline: true,
    showgrid: false,
    range: [0, 4.0],
    anchor: 'x4',
    title: 'non-CO<sub>2</sub> RF (W/m<sup>2</sup>)',
    titlefont: {size: 12},
    tickfont: {size: 12},
  },
};

const traces = [];
Plotly.newPlot(panel_a_div, traces, layout);
Plotly.addTraces(panel_a_div, defTraces);

panel_a_div.on('plotly_sliderchange', (event) => {
  console.log(event.step.args);
});




var slider = document.getElementById("myRange");
var slider2 = document.getElementById("myRange2");
var output = document.getElementById("demo");
var output2 = document.getElementById("demo2");
output.innerHTML = slider.value;
output2.innerHTML = slider2.value;

var grey_on = true;
var blue_on = false;
var purple_on = false;

slider.oninput = function() {

  if (purple_on == false) {
    defTraces[11].visible = false;
    defTraces[12].visible = false;
  };

  defTraces[28].visible = true;
  defTraces[29].visible = true;

  var slider2_val = slider2.value / 100;
  var RF_top = def_otherRF(RF_top_original, slider2_val, RF_middle_original);
  var RF_bottom = def_otherRF(RF_bottom_original, slider2_val, RF_middle_original);
  var RF_middle = def_otherRF(RF_middle_original, slider2_val, RF_middle_original);

  defTraces[27].y = RF_middle.slice(2011-1765,2101-1765);


  output.innerHTML = this.value;

  // E_hist = Array(years.length).fill(0.0);

  // for (var i = 0; i <= 2020-1765; i++) {
  //   E_hist[i] = E_pre2020[i];
  // };

  // var E_zero_date = this.value;
  // // if (Math.abs(E_zero_date - 2040) < 3) {
  // //   E_zero_date = 2040;
  // //   output.innerHTML = E_zero_date;
  // // };

  // E_update = def_emissions(E_hist, E_zero_date);
  E_hist = Array(years.length).fill(0.0);

  for (var i = 0; i <= 2020-1765; i++) {
    E_hist[i] = E_pre2020[i];
  };

  E_update = def_emissions(E_hist, this.value);





  var fair_out_top = fair_scm(E_update, RF_top, d, TCR_top, ECS_top, r_top, tau, a, dt, PI_conc, f, emis2conc, F_2x);
  var C_top = fair_out_top[0];
  var RF_top_total = fair_out_top[1];
  var T_top = fair_out_top[2];

  //  rebaseline T
  var years_for_slice = [...Array(1901-1850).keys()];
  for (var i = 0; i <= years_for_slice.length - 1; i++) {
    years_for_slice[i] += 1850 - 1765;
  };

  var sum = 0;
  for (var i = 0; i <= years_for_slice.length-1; i++) {
    sum += T_top[years_for_slice[i]];
  };
  var avg_top = sum / years_for_slice.length;

  for (var i = 0; i<= T_top.length-1; i++) {
    T_top[i] -= avg_top;
  };

  defTraces[28].y = T_top.slice(2018-1765,2101-1765);

  // console.log(T_top[2100-1765]<1.52);
  // console.log('test log');

  if ((E_update[2040-1765] == 0)) {
    // (grey_on=true)*(purple_on==false)
    // T_top[2100-1765] < 1.52
    // console.log('yas')
    defTraces[8].color = 'rgba(84,130,255,0.5)';
    defTraces[8].opacity = 0.5;
    defTraces[9].fillcolor = 'rgba(84,130,255,0.5)';
    defTraces[9].opacity = 0.5;
    defTraces[9].visible = true;
    defTraces[8].visible = true;
    defTraces[6].opacity = 0.0;
    defTraces[5].opacity = 0.0;
    defTraces[5].visible = false;
    defTraces[6].visible = false;
    defTraces[6].fillcolor = 'rgba(100,100,100,0.1)';
    defTraces[29].line.color = 'rgba(75,50,255,1.0)';
    defTraces[28].line.color = 'rgba(75,50,255,1.0)';

    grey_on = false;
    blue_on = true;
  } else if ((E_update[2040-1765] > 0)) {
    // *(blue_on=true)*(purple_on==false)
    // T_top[2100-1765] > 1.52
    defTraces[8].color = 'rgba(84,130,255,0.0)';
    defTraces[8].opacity = 0.0;
    defTraces[9].fillcolor = 'rgba(84,130,255,0.0)';
    defTraces[9].opacity = 0.0;
    defTraces[9].visible = false;
    defTraces[8].visible = false;
    defTraces[29].line.color = 'rgba(0,0,0,1.0)';
    defTraces[28].line.color = 'rgba(0,0,0,1.0)';
    if (purple_on == true) {
      grey_on = false;
      blue_on = false;
    } else {
      defTraces[6].visible = true;
      defTraces[5].visible = true;
      defTraces[6].opacity = 0.0;
      defTraces[5].opacity = 0.0;
      defTraces[6].fillcolor = 'rgba(100,100,100,0.5)';
      grey_on = true;
      blue_on = false;
    };
  };

  // console.log(blue_on, purple_on, grey_on);



  var fair_out_bottom = fair_scm(E_update, RF_bottom, d, TCR_bottom, ECS_bottom, r_bottom, tau, a, dt, PI_conc, f, emis2conc, F_2x);
  var C_bottom = fair_out_bottom[0];
  var RF_bottom_total = fair_out_bottom[1];
  var T_bottom = fair_out_bottom[2];

  var sum_bottom = 0;
  for (var i = 0; i <= years_for_slice.length-1; i++) {
    sum_bottom += T_bottom[years_for_slice[i]];
  };
  var avg_bottom = sum_bottom / years_for_slice.length;

  for (var i = 0; i<= T_bottom.length-1; i++) {
    T_bottom[i] -= avg_bottom;
  };

  defTraces[29].y = T_bottom.slice(2018-1765,2101-1765);




  for (var i = 0; i<=E_update.length-1; i++) {
    E_update[i] *= 44/12;
  };

  defTraces[25].y = E_update.slice(2018-1765,2101-1765);

  var G_update = Array(E_update.length).fill(0);
  G_update[0] = E_update[0];
  for (var i = 1; i <= E_update.length-1; i++) {
    G_update[i] = G_update[i-1] + E_update[i]/1000;
  };

  var to_remove = G_update[1870-1765];
  for (var i = G_update.length - 1; i >= 0; i--) {
    G_update[i] -= to_remove;
  };

  defTraces[26].y = G_update.slice(2016-1765,2101-1765);


  Plotly.deleteTraces(panel_a_div, [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]);
  Plotly.addTraces(panel_a_div, defTraces); 
};

output2.innerHTML = slider2.value / 100;
slider2.oninput = function() {
  output2.innerHTML = this.value / 100;

  var slider2_val = this.value / 100;

  if (blue_on == false) {
    defTraces[8].visible = false;
    defTraces[9].visible = false;
  };
  defTraces[28].visible = true;
  defTraces[29].visible = true;

  RF_top = def_otherRF(RF_top_original, slider2_val, RF_middle_original);
  RF_bottom = def_otherRF(RF_bottom_original, slider2_val, RF_middle_original);
  RF_middle = def_otherRF(RF_middle_original, slider2_val, RF_middle_original);

  defTraces[27].y = RF_middle.slice(2011-1765,2101-1765);



  E_hist = Array(years.length).fill(0.0);

  for (var i = 0; i <= 2020-1765; i++) {
    E_hist[i] = E_pre2020[i];
  };

  E_update = def_emissions(E_hist, slider.value);


  var fair_out_top = fair_scm(E_update, RF_top, d, TCR_top, ECS_top, r_top, tau, a, dt, PI_conc, f, emis2conc, F_2x);
  var C_top = fair_out_top[0];
  var RF_top_total = fair_out_top[1];
  var T_top = fair_out_top[2];

  //  rebaseline T
  var years_for_slice = [...Array(1901-1850).keys()];
  for (var i = 0; i <= years_for_slice.length - 1; i++) {
    years_for_slice[i] += 1850 - 1765;
  };

  var sum = 0;
  for (var i = 0; i <= years_for_slice.length-1; i++) {
    sum += T_top[years_for_slice[i]];
  };
  var avg_top = sum / years_for_slice.length;

  for (var i = 0; i<= T_top.length-1; i++) {
    T_top[i] -= avg_top;
  };


  var fair_out_bottom = fair_scm(E_update, RF_bottom, d, TCR_bottom, ECS_bottom, r_bottom, tau, a, dt, PI_conc, f, emis2conc, F_2x);
  var C_bottom = fair_out_bottom[0];
  var RF_bottom_total = fair_out_bottom[1];
  var T_bottom = fair_out_bottom[2];

  var sum_bottom = 0;
  for (var i = 0; i <= years_for_slice.length-1; i++) {
    sum_bottom += T_bottom[years_for_slice[i]];
  };
  var avg_bottom = sum_bottom / years_for_slice.length;

  for (var i = 0; i<= T_bottom.length-1; i++) {
    T_bottom[i] -= avg_bottom;
  };

  defTraces[28].y = T_top.slice(2018-1765,2101-1765);
  defTraces[29].y = T_bottom.slice(2018-1765,2101-1765);



  if ((RF_middle[2100-1765] >= RF_middle[2030-1765])) {
    // *(grey_on = true)*(blue_on==false)
    // T_top[2100-1765] > 2.0
    defTraces[11].color = 'rgba(128,0,104,0.5)';
    defTraces[11].opacity = 0.5;
    defTraces[12].fillcolor = 'rgba(128,0,104,0.5)';
    defTraces[12].opacity = 0.5;
    defTraces[12].visible = true;
    defTraces[11].visible = true;
    defTraces[6].opacity = 0.0;
    defTraces[5].opacity = 0.0;
    defTraces[5].visible = false;
    defTraces[6].visible = false;
    // defTraces[6].fillcolor = 'rgba(100,100,100,0.0)';
    defTraces[29].line.color = 'rgba(128,0,104,1.0)';
    defTraces[28].line.color = 'rgba(128,0,104,1.0)';
    // purple_on = true;
    // grey_on = false;
    // blue_on = false;
    
    // if (blue_on == true) {
    grey_on = false;
    purple_on = true;
  } else if ((RF_middle[2100-1765] < RF_middle[2030-1765])) {
    // *(purple_on=true)*(blue_on==false)
    // T_top[2100-1765] < 2.0
    defTraces[11].color = 'rgba(128,0,104,0.0)';
    defTraces[11].opacity = 0.0;
    defTraces[12].fillcolor = 'rgba(128,0,104,0.0)';
    defTraces[12].opacity = 0.0;
    defTraces[12].visible = false;
    defTraces[11].visible = false;
    defTraces[29].line.color = 'rgba(0,0,0,1.0)';
    defTraces[28].line.color = 'rgba(0,0,0,1.0)';

    if (blue_on == true) {
      grey_on = false;
      purple_on = false;
      defTraces[6].visible = false;
      defTraces[5].visible = false;
      defTraces[6].opacity = 0.0;
      defTraces[5].opacity = 0.0;
      defTraces[6].fillcolor = 'rgba(100,100,100,0.0)';
    } else {
      // console.log('now_2');
      grey_on = true;
      purple_on = false;
      defTraces[6].visible = true;
      defTraces[5].visible = true;
      defTraces[6].opacity = 0.5;
      defTraces[5].opacity = 0.5;
      defTraces[6].fillcolor = 'rgba(100,100,100,0.5)';
    };
  };



  Plotly.deleteTraces(panel_a_div, [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]);
  Plotly.addTraces(panel_a_div, defTraces);
};

